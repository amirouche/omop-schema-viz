(this["webpackJsonpomop-schema-viz"]=this["webpackJsonpomop-schema-viz"]||[]).push([[0],{101:function(e,t,n){},200:function(e,t,n){"use strict";n.r(t);var r=n(44),a=n(5),u=n.n(a),c=n(7),i=n(0),o=n.n(i);n(101),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(102);var l=n(205),s=n(206),m=n(90),f=n(207),p=n(209),h=n(208),v=n(210),d=n(211),g=n(212),b=n(60),E=n(62),y=n(95),w=n(45),k=n(46),x=n(37),A=n.n(x),O=n(47),j=n.n(O),N=function(){var e=Array.prototype.slice.call(arguments);return e[e.length-1]},S=function(){function e(){Object(w.a)(this,e),this.routes=[],this.route=void 0}return Object(k.a)(e,[{key:"append",value:function(e,t,n){if(!e.startsWith("/"))throw new Error("Pattern must start with a /");if(!e.endsWith("/"))throw new Error("Pattern must end with a /");this.routes.push({pattern:e,init:t,view:n})}},{key:"resolve",value:function(){var e=Object(c.a)(u.a.mark((function e(t,n){var r,a,c,i,o,l,s,m,f,p=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N("resolving route..."),r=document.location.pathname.split("/"),i=0;case 3:if(!(i<this.routes.length)){e.next=17;break}if(o=this.routes[i],l=this.match(o,r),s=Object(y.a)(l,2),a=s[0],c=s[1],!a){e.next=14;break}return e.delegateYield(u.a.mark((function e(){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.route=o,N("router matched route",o),e.next=4,o.init(t,n,c);case 4:return r=e.sent,e.abrupt("return",{v:function(e){return r()}});case 6:case"end":return e.stop()}}),e)}))(),"t0",11);case 11:if("object"!==typeof(m=e.t0)){e.next=14;break}return e.abrupt("return",m.v);case 14:i++,e.next=3;break;case 17:throw N(f="no matching route found!"),new Error(f);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t){var n=e.pattern.split("/");if(n.length!==t.length)return[!1,{}];for(var r={},a=0;a<n.length;a++){var u=n[a];if(u.startsWith("{")&&u.endsWith("}"))r[u.slice(1,-1)]=t[a];else if(u!==t[a])return[!1,{}]}return[!0,r]}}]),e}(),T=function(e){return function(t,n){return function(){var r=Object(c.a)(u.a.mark((function r(a){var c;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),window.history.pushState({},"",e),c=t.router.resolve(t,n),window.scrollTo(0,0),r.abrupt("return",c);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}},C=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r,a){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N("redirecting...",t,n,r),window.history.pushState({},"",r),e.next=4,t.router.resolve(t,n);case 4:return c=e.sent,(a||void 0===a)&&window.scrollTo(0,0),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),P=function(e){var t=j()({});return Object.keys(e).filter((function(e){return e.startsWith("%")})).forEach((function(n){t=t.set(n,e[n])})),t},q=function(){var e=Object(c.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(function(e,t){return P(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(e){Object(E.a)(n,e);var t=Object(b.a)(n);function n(e){var r;return Object(w.a)(this,n),(r=t.call(this,e)).title=e.title,r}return Object(k.a)(n,[{key:"componentDidMount",value:function(){document.title=this.props.title}},{key:"componentDidUpdate",value:function(){document.title=this.props.title}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),n}(o.a.Component),L=function(e){Object(E.a)(n,e);var t=Object(b.a)(n);function n(e){var r;Object(w.a)(this,n);for(var a=arguments.length,u=new Array(a>1?a-1:0),c=1;c<a;c++)u[c-1]=arguments[c];return(r=t.call.apply(t,[this,e].concat(u))).state={value:e.value||""},r}return Object(k.a)(n,[{key:"componentWillReceiveProps",value:function(e){this.state.value!==e.value&&this.setState({value:e.value})}},{key:"onChange",value:function(e){var t=this;e.persist(),this.setState({value:e.target.value},(function(){return t.props.onChange(e)}))}},{key:"render",value:function(){return o.a.createElement("input",Object.assign({},this.props,this.state,{onChange:this.onChange.bind(this)}))}}]),n}(o.a.Component),Y=function(e,t){return function(){var n=Object(c.a)(u.a.mark((function n(r){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return window.localStorage.removeItem("%token"),n.next=3,C(e,t,"/");case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},I={Immutable:j.a,Link:function(e){var t=e.mc,n=e.href,r=e.children,a=e.className;return o.a.createElement("a",{href:n,onClick:t(T(n)),className:a},r)},Logout:function(e){var t=e.mc;return o.a.createElement("span",{id:"logout",onClick:t(Y)},"Logout")},Router:S,Title:R,clean:P,createApp:function(e){var t=function(e,t,n,r){var a,u=n(),c=function(t){return function(n){n.persist(),t(e,u,n).then((function(e){var t=e();u=t,a()}))}};return a=function(){var e=r(u,c);(A.a.render(e,t),""!==document.location.hash)&&document.querySelector(document.location.hash).scrollIntoView()},function(t){t(e,u).then((function(e){if(e){var t=e();u=t,a()}}))}}({router:e},document.getElementById("root"),(function(){return j()({})}),(function(t,n){return e.route.view(t,n)}));return window.onpopstate=function(n){return t(e.resolve.bind(e))},N("initial rendering"),t(e.resolve.bind(e)),t},get:function(e,t){var n=new Request(e);return t&&n.headers.set("X-AUTH-TOKEN",t),fetch(n)},getToken:function(e){return e["%token"]||window.localStorage.getItem("%token")},setToken:function(e){window.localStorage.setItem("%token",e)},pk:N,post:function(e,t,n){var r=new Request(e,{method:"POST",body:JSON.stringify(t)});return n&&r.headers.set("X-AUTH-TOKEN",n),fetch(r)},redirect:C,set:function(e){return function(t,n){return function(){var t=Object(c.a)(u.a.mark((function t(n){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.target.value,t.abrupt("return",(function(t,n){return n.set(e,r)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},routeClean:q,Input:L},D=n(59),F=n.n(D),W=n(87),X=new I.Router,z=function(e){return e.href?o.a.createElement("a",{href:e.$ref},e.children):"[ ".concat(e.children[0].props.value," ]")},B=function(e){if("Table"===e.tagName)return e.getAttribute("name");var t=e.parentElement.getAttribute("name"),n=e.getAttribute("name");return t+"#"+e.tagName+"#"+n},_={nodeHighlightBehavior:!0,node:{color:"lightgreen",size:120,highlightStrokeColor:"blue"},link:{highlightColor:"lightblue"},height:768,width:1024},H=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r){var a,c,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.schema,c='//*[@name="'.concat(r,'"]'),i=a.evaluate(c,a,null,XPathResult.ANY_TYPE,null),o=i.iterateNext(),n={schema:a,element:o},e.abrupt("return",(function(){return n}));case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),K=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r){var a,c,i,o,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.get("/schema.xml");case 2:return a=e.sent,e.next=5,a.text();case 5:return c=e.sent,i=new DOMParser,o=i.parseFromString(c,"application/xml"),l={schema:o,element:void 0},e.abrupt("return",(function(){return l}));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();X.append("/graph/",K,(function(e,t){for(var n,a,u=e.schema,c=e.element,i={nodes:[],links:[]},f=u.evaluate("//table",u,null,XPathResult.ANY_TYPE,null);n=f.iterateNext();){var p=n.querySelectorAll(":scope > column");n=n.getAttribute("name"),i.nodes.push({id:n,symbolType:"diamond",size:150,color:"red"});var h,v=Object(r.a)(p);try{for(v.s();!(h=v.n()).done;){var d=h.value;d=d.getAttribute("name"),i.nodes.push({id:d}),i.links.push({source:n,target:d})}}catch(g){v.e(g)}finally{v.f()}}return a=void 0!==c?o.a.createElement($,{element:c,mc:t}):o.a.createElement("p",null,"Select a node"),o.a.createElement(o.a.Fragment,null,o.a.createElement(Q,null),o.a.createElement(l.a,{fluid:!0},o.a.createElement(s.a,null,o.a.createElement(m.a,null,o.a.createElement(W.Graph,{id:"graph-id",data:i,config:_,onClickNode:t(H)})),o.a.createElement(m.a,null,a))))}));var M=function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r,a,c,i,o,l,s,m,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.get("/schema.xml");case 2:return t=e.sent,e.next=5,t.text();case 5:if(n=e.sent,r=new DOMParser,a=r.parseFromString(n,"application/xml"),c=new URLSearchParams(window.location.search),i=c.get("q")||"",o=[],""!==i){for(s=[],m=a.evaluate("//table",a,null,XPathResult.ANY_TYPE,null);l=m.iterateNext();)s.push(l);for(m=a.evaluate("//table/column",a,null,XPathResult.ANY_TYPE,null);l=m.iterateNext();)s.push(l);o=s.filter((function(e){return U(e,i)}))}return f={schema:a,query:i,hits:o},e.abrupt("return",(function(){return f}));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(e,t){var n=t.toLowerCase().replace("+"," ").split(/(\s+)/).filter((function(e){return e.trim().length>0})),a=e.getAttribute("remarks")+" "+e.getAttribute("name");a=(a=(a=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")).replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g," ")).split(/(\s+)/).filter((function(e){return e.trim().length>0}));var u={};a.forEach((function(e){var t,a=Object(r.a)(n);try{for(a.s();!(t=a.n()).done;){var c=t.value;if(e.includes(c))return void(u[c]=!0)}}catch(i){a.e(i)}finally{a.f()}}));return Object.keys(u).length===n.length},G=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.abrupt("return",I.redirect(t,n,"/?q="+n.query));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),J=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.query=r.target.value,e.abrupt("return",(function(){return n}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),$=function(e){var t,n=e.element,r=e.mc;"table"===n.tagName?t=o.a.createElement(f.a,{variant:"primary"},"Table"):"column"===n.tagName&&(t=o.a.createElement(f.a,{variant:"secondary"},"Column"));var a=n.getAttribute("name");return o.a.createElement("div",null,t," ",o.a.createElement(I.Link,{mc:r,href:"/reference/#"+a},a)," ",o.a.createElement("small",{className:"text-muted"},n.getAttribute("remarks")))};X.append("/",M,(function(e,t){var n=e.query,r=e.hits.map((function(e){return o.a.createElement($,{key:B(e),element:e,mc:t})}));return o.a.createElement(o.a.Fragment,null,o.a.createElement(Q,null),o.a.createElement(l.a,null,o.a.createElement(s.a,null,o.a.createElement(m.a,null,o.a.createElement(p.a,{onSubmit:t(G)},o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,null,"Recherche"),o.a.createElement(p.a.Control,{type:"text",placeholder:"filtre",value:n,onChange:t(J)}),o.a.createElement(p.a.Text,{className:"text-muted"},"Filtrer les tables ou colonnes.")),o.a.createElement(h.a,{variant:"primary",type:"submit"},"Submit")))),r))}));var V=function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.get("/schema.xml");case 2:return t=e.sent,e.next=5,t.text();case 5:return n=e.sent,r=new DOMParser,a=r.parseFromString(n,"application/xml"),c={schema:a},e.abrupt("return",(function(e,t){return c}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){return o.a.createElement(v.a,{bg:"light",expand:"lg"},o.a.createElement(v.a.Brand,{href:"/"},"omop-schema-viz"),o.a.createElement(v.a.Toggle,{"aria-controls":"basic-navbar-nav"}),o.a.createElement(v.a.Collapse,{id:"basic-navbar-nav"},o.a.createElement(d.a,{className:"mr-auto"},o.a.createElement(d.a.Link,{href:"/"},"Home"),o.a.createElement(d.a.Link,{href:"/reference/"},"Reference"),o.a.createElement(d.a.Link,{href:"/graph/"},"Graph"))))},Z=function(e){var t=e.column,n=e.pk,a=t.getAttribute("name"),u=t.getAttribute("remarks"),c=function(e,t){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var u=n.value;if(u.getAttribute("column")===t)return u.getAttribute("sequenceNumberInPK")}}catch(c){a.e(c)}finally{a.f()}return!1}(n,a);return n=c?o.a.createElement(f.a,{variant:"info",title:"sequence number in primary key"},c):"",o.a.createElement("div",null,o.a.createElement("h3",{id:a},o.a.createElement(f.a,{variant:"secondary"},"Column")," ",n," ",a),o.a.createElement(F.a,{renderers:{linkReference:z},source:u}))},ee=function(e){var t,n=e.column,r=n.getAttribute("name");return t="true"===n.getAttribute("ascending")?o.a.createElement(f.a,{variant:"success"},"ascending"):o.a.createElement(f.a,{variant:"danger"},"descending"),o.a.createElement("li",null,r," ",t)},te=function(e){var t,n=e.index,r=n.getAttribute("name");t="true"===n.getAttribute("unique")?o.a.createElement(f.a,{variant:"warning"},"unique"):"";var a=Array.prototype.slice.call(n.querySelectorAll(":scope > column"));return o.a.createElement(g.a,null,o.a.createElement(g.a.Body,null,o.a.createElement("div",null,o.a.createElement("h4",null,o.a.createElement(f.a,{variant:"success"},"Index")," ",t," ",r),o.a.createElement("ul",null,a.map((function(e){return o.a.createElement(ee,{key:B(e),column:e})}))))))},ne=function(e){var t=e.table,n=t.getAttribute("name"),r=t.getAttribute("remarks"),a=Array.prototype.slice.call(t.querySelectorAll(":scope > column")),u=Array.prototype.slice.call(t.querySelectorAll(":scope > index")),c=Array.prototype.slice.call(t.querySelectorAll(":scope > primaryKey"));return o.a.createElement(l.a,{fluid:"md"},o.a.createElement(s.a,null,o.a.createElement(m.a,null,o.a.createElement(g.a,null,o.a.createElement(g.a.Body,null,o.a.createElement("h2",{id:n},o.a.createElement(f.a,{variant:"primary"},"Table")," ",n),o.a.createElement(F.a,{renderers:{linkReference:z},source:r}),a.map((function(e){return o.a.createElement(Z,{key:B(e),column:e,pk:c})})),u.map((function(e){return o.a.createElement(te,{key:B(e),index:e})})))))))};X.append("/reference/",V,(function(e,t){for(var n,r=e.schema,a=r.evaluate("//table",r,null,XPathResult.ANY_TYPE,null),u=[];n=a.iterateNext();)u.push(n);return o.a.createElement(o.a.Fragment,null,o.a.createElement(Q,null),u.map((function(e){return o.a.createElement(ne,{key:B(e),table:e})})))})),I.createApp(X),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,n){e.exports=n(200)}},[[98,1,2]]]);
//# sourceMappingURL=main.1ac97ed1.chunk.js.map