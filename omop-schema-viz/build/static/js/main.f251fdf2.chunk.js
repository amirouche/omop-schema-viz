(this["webpackJsonpomop-schema-viz"]=this["webpackJsonpomop-schema-viz"]||[]).push([[0],{151:function(e,t,n){"use strict";n.r(t);var r=n(50),a=n(5),u=n.n(a),c=n(8),i=n(0),o=n.n(i);n(62),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(63);var l=n(154),s=n(155),m=n(156),f=n(53),p=n(158),h=n(157),v=n(159),d=n(160),b=n(161),g=n(36),E=n(38),y=n(58),w=n(26),k=n(27),x=n(19),A=n.n(x),O=n(28),j=n.n(O),N=function(){var e=Array.prototype.slice.call(arguments);return e[e.length-1]},S=function(){function e(){Object(w.a)(this,e),this.routes=[],this.route=void 0}return Object(k.a)(e,[{key:"append",value:function(e,t,n){if(!e.startsWith("/"))throw new Error("Pattern must start with a /");if(!e.endsWith("/"))throw new Error("Pattern must end with a /");this.routes.push({pattern:e,init:t,view:n})}},{key:"resolve",value:function(){var e=Object(c.a)(u.a.mark((function e(t,n){var r,a,c,i,o,l,s,m,f,p=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N("resolving route..."),r=document.location.pathname.split("/"),i=0;case 3:if(!(i<this.routes.length)){e.next=17;break}if(o=this.routes[i],l=this.match(o,r),s=Object(y.a)(l,2),a=s[0],c=s[1],!a){e.next=14;break}return e.delegateYield(u.a.mark((function e(){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.route=o,N("router matched route",o),e.next=4,o.init(t,n,c);case 4:return r=e.sent,e.abrupt("return",{v:function(e){return r()}});case 6:case"end":return e.stop()}}),e)}))(),"t0",11);case 11:if("object"!==typeof(m=e.t0)){e.next=14;break}return e.abrupt("return",m.v);case 14:i++,e.next=3;break;case 17:throw N(f="no matching route found!"),new Error(f);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t){var n=e.pattern.split("/");if(n.length!==t.length)return[!1,{}];for(var r={},a=0;a<n.length;a++){var u=n[a];if(u.startsWith("{")&&u.endsWith("}"))r[u.slice(1,-1)]=t[a];else if(u!==t[a])return[!1,{}]}return[!0,r]}}]),e}(),T=function(e){return function(t,n){return function(){var r=Object(c.a)(u.a.mark((function r(a){var c;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),window.history.pushState({},"",e),c=t.router.resolve(t,n),window.scrollTo(0,0),r.abrupt("return",c);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}},q=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r,a){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N("redirecting...",t,n,r),window.history.pushState({},"",r),e.next=4,t.router.resolve(t,n);case 4:return c=e.sent,(a||void 0===a)&&window.scrollTo(0,0),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),C=function(e){var t=j()({});return Object.keys(e).filter((function(e){return e.startsWith("%")})).forEach((function(n){t=t.set(n,e[n])})),t},P=function(){var e=Object(c.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(function(e,t){return C(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(e){Object(E.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(w.a)(this,n),(r=t.call(this,e)).title=e.title,r}return Object(k.a)(n,[{key:"componentDidMount",value:function(){document.title=this.props.title}},{key:"componentDidUpdate",value:function(){document.title=this.props.title}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),n}(o.a.Component),I=function(e){Object(E.a)(n,e);var t=Object(g.a)(n);function n(e){var r;Object(w.a)(this,n);for(var a=arguments.length,u=new Array(a>1?a-1:0),c=1;c<a;c++)u[c-1]=arguments[c];return(r=t.call.apply(t,[this,e].concat(u))).state={value:e.value||""},r}return Object(k.a)(n,[{key:"componentWillReceiveProps",value:function(e){this.state.value!==e.value&&this.setState({value:e.value})}},{key:"onChange",value:function(e){var t=this;e.persist(),this.setState({value:e.target.value},(function(){return t.props.onChange(e)}))}},{key:"render",value:function(){return o.a.createElement("input",Object.assign({},this.props,this.state,{onChange:this.onChange.bind(this)}))}}]),n}(o.a.Component),W=function(e,t){return function(){var n=Object(c.a)(u.a.mark((function n(r){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return window.localStorage.removeItem("%token"),n.next=3,q(e,t,"/");case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},L={Immutable:j.a,Link:function(e){var t=e.mc,n=e.href,r=e.children,a=e.className;return o.a.createElement("a",{href:n,onClick:t(T(n)),className:a},r)},Logout:function(e){var t=e.mc;return o.a.createElement("span",{id:"logout",onClick:t(W)},"Logout")},Router:S,Title:R,clean:C,createApp:function(e){var t=function(e,t,n,r){var a,u=n(),c=function(t){return function(n){t(e,u,n).then((function(e){var t=e();u=t,a()}))}};return a=function(){var e=r(u,c);A.a.render(e,t)},function(t){t(e,u).then((function(e){if(e){var t=e();u=t,a()}}))}}({router:e},document.getElementById("root"),(function(){return j()({})}),(function(t,n){return e.route.view(t,n)}));return window.onpopstate=function(n){return t(e.resolve.bind(e))},N("initial rendering"),t(e.resolve.bind(e)),t},get:function(e,t){var n=new Request(e);return t&&n.headers.set("X-AUTH-TOKEN",t),fetch(n)},getToken:function(e){return e["%token"]||window.localStorage.getItem("%token")},setToken:function(e){window.localStorage.setItem("%token",e)},pk:N,post:function(e,t,n){var r=new Request(e,{method:"POST",body:JSON.stringify(t)});return n&&r.headers.set("X-AUTH-TOKEN",n),fetch(r)},redirect:q,set:function(e){return function(t,n){return function(){var t=Object(c.a)(u.a.mark((function t(n){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.target.value,t.abrupt("return",(function(t,n){return n.set(e,r)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},routeClean:P,Input:I},Y=n(35),D=n.n(Y),B=new L.Router,F=function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.get("/schema.xml");case 2:return t=e.sent,e.next=5,t.text();case 5:return n=e.sent,r=new DOMParser,a=r.parseFromString(n,"application/xml"),c={schema:a,query:"",hits:[]},e.abrupt("return",(function(){return c}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(e,t){return e.getAttribute("remarks").includes(t)},K=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r){var a,c,i,o,l,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r.preventDefault(),a=n.schema,c=n.query,o=[],l=a.evaluate("//table",a,null,XPathResult.ANY_TYPE,null);i=l.iterateNext();)o.push(i);for(l=a.evaluate("//table/column",a,null,XPathResult.ANY_TYPE,null);i=l.iterateNext();)o.push(i);return s=o.filter((function(e){return X(e,c)})),n.hits=s,e.abrupt("return",(function(){return n}));case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),z=function(){var e=Object(c.a)(u.a.mark((function e(t,n,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.query=r.target.value,e.abrupt("return",(function(){return n}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),H=function(e){var t,n=e.element;"table"===n.tagName?t=o.a.createElement(l.a,{variant:"primary"},"Table"):"column"===n.tagName&&(t=o.a.createElement(l.a,{variant:"secondary"},"Column"));var r=n.getAttribute("name");return o.a.createElement("div",null,t," ",o.a.createElement("a",{href:"/reference/#"+r},r)," ",o.a.createElement("small",{className:"text-muted"},n.getAttribute("remarks")))},J=function(){var e=Object(c.a)(u.a.mark((function e(){var t,n,r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.get("/schema.xml");case 2:return t=e.sent,e.next=5,t.text();case 5:return n=e.sent,r=new DOMParser,a=r.parseFromString(n,"application/xml"),c={schema:a},e.abrupt("return",(function(e,t){return c}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){return o.a.createElement(v.a,{bg:"light",expand:"lg"},o.a.createElement(v.a.Brand,{href:"/"},"omop-schema-viz"),o.a.createElement(v.a.Toggle,{"aria-controls":"basic-navbar-nav"}),o.a.createElement(v.a.Collapse,{id:"basic-navbar-nav"},o.a.createElement(d.a,{className:"mr-auto"},o.a.createElement(d.a.Link,{href:"/"},"Home"),o.a.createElement(d.a.Link,{href:"/reference/"},"Reference"),o.a.createElement(d.a.Link,{href:"/graph/"},"Graph"))))},U=function(e){var t=e.column,n=e.pk,a=t.getAttribute("name"),u=t.getAttribute("remarks"),c=function(e,t){var n,a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var u=n.value;if(u.getAttribute("column")===t)return u.getAttribute("sequenceNumberInPK")}}catch(c){a.e(c)}finally{a.f()}return!1}(n,a);return n=c?o.a.createElement(l.a,{variant:"info",title:"sequence number in primary key"},c):"",o.a.createElement("div",null,o.a.createElement("h3",{id:a},o.a.createElement(l.a,{variant:"secondary"},"Column")," ",n," ",a),o.a.createElement(D.a,{source:u}))},_=function(e){var t,n=e.column,r=n.getAttribute("name");return t="true"===n.getAttribute("ascending")?o.a.createElement(l.a,{variant:"success"},"ascending"):o.a.createElement(l.a,{variant:"danger"},"descending"),o.a.createElement("li",null,r," ",t)},G=function(e){var t,n=e.index,r=n.getAttribute("name");t="true"===n.getAttribute("unique")?o.a.createElement(l.a,{variant:"warning"},"unique"):"";var a=Array.prototype.slice.call(n.querySelectorAll(":scope > column"));return o.a.createElement(b.a,null,o.a.createElement(b.a.Body,null,o.a.createElement("div",null,o.a.createElement("h4",null,o.a.createElement(l.a,{variant:"success"},"Index")," ",t," ",r),o.a.createElement("ul",null,a.map((function(e){return o.a.createElement(_,{key:e.getAttribute("name"),column:e})}))))))},$=function(e){var t=e.table,n=t.getAttribute("name"),r=t.getAttribute("remarks"),a=Array.prototype.slice.call(t.querySelectorAll(":scope > column")),u=Array.prototype.slice.call(t.querySelectorAll(":scope > index")),c=Array.prototype.slice.call(t.querySelectorAll(":scope > primaryKey"));return o.a.createElement(s.a,{fluid:"md"},o.a.createElement(m.a,null,o.a.createElement(f.a,null,o.a.createElement(b.a,null,o.a.createElement(b.a.Body,null,o.a.createElement("h2",{id:n},o.a.createElement(l.a,{variant:"primary"},"Table")," ",n),o.a.createElement(D.a,{source:r}),a.map((function(e){return o.a.createElement(U,{key:e.getAttribute("name"),column:e,pk:c})})),u.map((function(e){return o.a.createElement(G,{key:e.getAttribute("name"),index:e})})))))))};B.append("/",F,(function(e,t){var n=e.query,r=e.hits.map((function(e){return o.a.createElement(H,{element:e})}));return o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),o.a.createElement(s.a,null,o.a.createElement(m.a,null,o.a.createElement(f.a,null,o.a.createElement(p.a,{onSubmit:t(K)},o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,null,"Recherche"),o.a.createElement(p.a.Control,{type:"text",placeholder:"filtre",value:n,onChange:t(z)}),o.a.createElement(p.a.Text,{className:"text-muted"},"Filtrer les tables ou colonnes.")),o.a.createElement(h.a,{variant:"primary",type:"submit"},"Submit")))),r))})),B.append("/reference/",J,(function(e,t){for(var n,r=e.schema,a=r.evaluate("//table",r,null,XPathResult.ANY_TYPE,null),u=[];n=a.iterateNext();)u.push(n);return L.pk("tables",u),o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),u.map((function(e){return o.a.createElement($,{key:e.getAttribute("name"),table:e})})))})),L.createApp(B),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},59:function(e,t,n){e.exports=n(151)},62:function(e,t,n){}},[[59,1,2]]]);
//# sourceMappingURL=main.f251fdf2.chunk.js.map